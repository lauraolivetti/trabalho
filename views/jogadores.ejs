<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Gerenciar Jogadores</title>
</head>
<body>
    <a href="/">Voltar ao Menu</a>
    <h2>Cadastro de Jogador</h2>

    <% if (erro) { %> <p style="color: red;"><%= erro %></p> <% } %>

    <form action="/jogadores" method="POST">
        <label>Nome: <input type="text" name="nome"></label><br>
        <label>Nickname: <input type="text" name="nickname"></label><br>
        
        <label>Função:</label>
        <select name="funcao">
            <option value="Top">Top</option>
            <option value="Jungle">Jungle</option>
            <option value="Mid">Mid</option>
            <option value="Atirador">Atirador</option>
            <option value="Suporte">Suporte</option>
        </select><br>

        <label>Elo: <input type="text" name="elo" placeholder="Ex: Prata"></label><br>
        
        <label>Gênero:</label>
        <select name="genero">
            <option value="M">Masculino</option>
            <option value="F">Feminino</option>
            <option value="O">Outro</option>
        </select><br>

        <label>Equipe:</label>
        <select name="equipeId">
            <option value="" disabled selected>Selecione...</option>
            <% if (equipes.length > 0) { %>
                <% equipes.forEach(time => { %>
                    <option value="<%= time.id %>"><%= time.nome %></option>
                <% }) %>
            <% } else { %>
                <option value="" disabled>Cadastre uma equipe primeiro</option>
            <% } %>
        </select><br><br>

        <button type="submit">Cadastrar Jogador</button>
    </form>

    <hr>

    <h3>Jogadores (Agrupados por Equipe)</h3>
    <% if (equipes.length > 0) { %>
        <% equipes.forEach(time => { %>
            <h4>Equipe: <%= time.nome %> (Capitão: <%= time.capitao %>)</h4>
            <ul>
                <% const jogadoresDoTime = jogadores.filter(j => j.equipeId == time.id); %>
                
                <% if (jogadoresDoTime.length > 0) { %>
                    <% jogadoresDoTime.forEach(jogador => { %>
                        <li>
                            <strong><%= jogador.nickname %></strong> 
                            (<%= jogador.funcao %>) - Elo: <%= jogador.elo %>
                        </li>
                    <% }) %>
                <% } else { %>
                    <li><i>Sem jogadores cadastrados.</i></li>
                <% } %>
            </ul>
        <% }) %>
    <% } else { %>
        <p>Nenhuma equipe cadastrada para agrupar jogadores.</p>
    <% } %>
</body>
</html>